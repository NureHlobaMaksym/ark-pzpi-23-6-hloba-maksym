МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ
ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ

ФАКУЛЬТЕТ КОМП’ЮТЕРНИХ НАУК
КАТЕДРА ПРОГРАМНОЇ ІНЖЕНЕРІЇ


ЗВІТ
до лабораторного роботи №5
з дисципліни «Аналіз та рефакторинг коду» на тему: 
«РОЗГОРТАННЯ ПРОГРАМНОЇ СИСТЕМИ ТА ДЕМОНСТРАЦІЯ ЇЇ РОБОТИ»


Виконав:						Перевірив:
ст. гр. ПЗПІ-23-6				ас. катедри ПІ
Глоба Максим					Дашенков Дмитро Сергійович









Харків 2025
1 ЗАВДАННЯ
     Метою лабораторної роботи є набуття практичних навичок розгортання цілісної системи інтернету речей (IoT) та верифікації її працездатності. У ході виконання роботи студент повинен розгорнути серверну частину, включаючи базу даних та інструменти адміністрування, а також налаштувати IoT-клієнт для забезпечення стабільної взаємодії між усіма компонентами системи. Важливим етапом є конфігурація параметрів зв'язку та перевірка коректності передачі даних від пристрою до сервера згідно з визначеними протоколами.
     Для підтвердження успішної реалізації проєкту студент має продемонструвати функціональність, описану у розділі 2.2 Vision & Scope, шляхом детальної фіксації результатів роботи. Замість відеозапису необхідно підготувати розширений ілюстративний матеріал у вигляді скріншотів, які відображають роботу бізнес-логіки, процес адміністрування серверної частини, налаштування параметрів клієнта та безпосередню взаємодію компонентів у режимі реального часу. Кожна ключова функція системи повинна бути візуально підтверджена та супроводжена пояснювальним текстом у звіті.
     Результати роботи оформлюються у вигляді звіту, який містить опис етапів розгортання, протокол тестування функцій та графічні докази працездатності системи. Звіт експортується у формат PDF для завантаження на платформу dl.nure.ua. Паралельно весь зміст звіту має бути збережений у текстовому файлі з кодуванням UTF-8 та завантажений у GitHub-репозиторій у гілку main, що забезпечить повну документальну відповідність розробленого програмного забезпечення вимогам технічного завдання.


     2 ОПИС ВИКОНАНОЇ РОБОТИ
     2.1 Інфраструктура розгортання
     Програмна система InZone розгорнута на базі хмарної інфраструктури DigitalOcean під управлінням операційної системи Ubuntu. Для забезпечення стабільної роботи та швидкого масштабування використано технологію контейнеризації Docker. Архітектура рішення базується на сучасному стеку: серверна частина реалізована на фреймворку NestJS (v11), що забезпечує сувору типізацію та модульність завдяки TypeScript. В якості сховища даних вибрано реляційну СУБД PostgreSQL 15, а для обробки великої кількості повідомлень від IoT-пристроїв інтегровано брокер EMQX v5.5.0.
     Система доступна за доменним ім’ям in-zone.pp.ua. Для забезпечення безпеки передачі даних та захисту персональної інформації налаштовано HTTPS-з'єднання з використанням SSL-сертифікатів. REST API додатка автоматично документується за допомогою Swagger, що доступний за відповідним шляхом на основному домені, полегшуючи інтеграцію та тестування кінцевих точок.
     2.2 Конфігурація Docker Compose та управління даними
     Всі компоненти системи описані в декларативному форматі Docker Compose, що дозволяє керувати інфраструктурою як кодом. Конфігурація включає сервіс бази даних, брокер повідомлень та backend-додаток. Взаємодія з базою даних реалізована через TypeORM (v0.3), що дозволяє версіонувати схему даних за допомогою механізму міграцій.
     
      services:
        postgres:
          image: postgres:15
          container_name: rfid_postgres_prod
          restart: always
          ports:
            - ${DB_PORT}:${DB_PORT}
          environment:
            POSTGRES_USER: ${DB_USER}
            POSTGRES_PASSWORD: ${DB_PASS}
            POSTGRES_DB: ${DB_NAME}
          volumes:
            - pgdata_prod:/var/lib/postgresql/data
          networks:
            - inzone_network
      
        emqx:
          image: emqx/emqx:5.5.0
          container_name: inzone_emqx_prod
          restart: always
          ports:
            - '1883:1883'
            - '8083:8083'
            - '8084:8084'
            - '8883:8883'
            - '18083:18083'
          environment:
            EMQX_NAME: inzone_emqx
            EMQX_HOST: 0.0.0.0
            EMQX_NODE__COOKIE: ${MQTT_COOKIE}
            EMQX_DASHBOARD__DEFAULT_USERNAME: ${MQTT_DASHBOARD_USER}
            EMQX_DASHBOARD__DEFAULT_PASSWORD: ${MQTT_DASHBOARD_PASS}
            EMQX_ALLOW_ANONYMOUS: "false"
      
            EMQX_AUTHENTICATION__1__MECHANISM: password_based
            EMQX_AUTHENTICATION__1__BACKEND: http
            EMQX_AUTHENTICATION__1__ENABLE: "true"
            EMQX_AUTHENTICATION__1__METHOD: post
            EMQX_AUTHENTICATION__1__URL: ${BACKEND_URL}:${PORT}/mqtt/auth
            EMQX_AUTHENTICATION__1__HEADERS__CONTENT_TYPE: application/json
            EMQX_AUTHENTICATION__1__BODY: '{"username": "$${username}", "password": "$${password}", "clientid": "$${clientid}"}'
      
            EMQX_AUTHORIZATION__SOURCES__1__TYPE: http
            EMQX_AUTHORIZATION__SOURCES__1__ENABLE: "true"
            EMQX_AUTHORIZATION__SOURCES__1__URL: ${BACKEND_URL}:${PORT}/mqtt/acl
            EMQX_AUTHORIZATION__SOURCES__1__METHOD: post
            EMQX_AUTHORIZATION__SOURCES__1__HEADERS__CONTENT_TYPE: application/json
            EMQX_AUTHORIZATION__SOURCES__1__BODY: '{"username": "$${username}", "topic": "$${topic}", "action": "$${action}", "clientid": "$${clientid}"}'
          volumes:
            - emqx_data_prod:/opt/emqx/data
            - emqx_log_prod:/opt/emqx/log
          networks:
            - inzone_network
      
        backend:
          image: ${DOCKER_IMAGE_NAME}
          container_name: inzone_backend_prod
          restart: always
          ports:
            - ${PORT}:${PORT}
          env_file:
            - .env.prod
          depends_on:
            - postgres
            - emqx
          volumes:
            - /app/node_modules
          networks:
            - inzone_network
      
      volumes:
        pgdata_prod:
        emqx_data_prod:
        emqx_log_prod:
      
      networks:
        inzone_network:
          driver: bridge
     
     Особливістю збереження даних у системі є робота з просторовими координатами зон приміщень. Для відображення планів поверхів використано декартову систему координат (x, y, width, height), що дозволяє ефективно керувати геометрією зон без надлишкових обчислювальних витрат на стороні сервера.
     2.3. Взаємодія IoT та моніторинг у реальному часі
     Зв'язок між сервером та RFID-зчитувачами побудований на протоколі MQTT. Backend-частина виступає в ролі MQTT-клієнта, підписуючись на wildcard-топік inzone/readers/+/scan. Реалізовано систему делегованої аутентифікації: при спробі підключення пристрою брокер EMQX виконує HTTP-запит до бекенду (/mqtt/auth), що дозволяє централізовано перевіряти права доступу пристроїв на основі даних у PostgreSQL.
     Для миттєвої передачі подій адміністратору використано Socket.io. Логіка розділена на простори імен (/locations та /notifications). Для оптимізації мережевого трафіку застосовано механізм "кімнат" (Rooms): дані про переміщення співробітника у конкретній будівлі надсилаються лише тим клієнтам, які підписані на ідентифікатор цієї будівлі. Безпека з'єднань забезпечується валідацією JWT-токенів на етапі handshake.
     2.4 Налаштування та логіка IoT-клієнтів
     Клієнтську частину реалізовано на платформі ESP32 з використанням Arduino Framework. Налаштування пристроїв здійснюється через вбудований веб-портал на базі WiFiManager. У режимі точки доступу користувач може конфігурувати параметри WiFi, адресу MQTT-брокера та токени безпеки без необхідності перепрошивки пристрою. Всі налаштування зберігаються в енергонезалежній пам'яті (NVS).
     Програмне забезпечення клієнта виконує паралельне опитування двох UART-портів для зчитування даних з RFID-модулів. Бізнес-логіка включає фільтрацію службових символів протоколу зчитувача, реалізацію програмного захисту від брязкоту контактів (debouncing) та формування JSON-пакетів для передачі на сервер. Це забезпечує високу точність фіксації подій проходження персоналу крізь контрольні зони.

3 ВИСНОВКИ
     У ході виконання лабораторної роботи було успішно здійснено повний цикл розгортання та верифікації працездатності системи моніторингу персоналу InZone. Основну увагу було приділено створенню цілісної інфраструктури, що об'єднує вбудовані системи на базі мікроконтролерів ESP32, хмарний сервер на DigitalOcean та інтелектуальні механізми обробки подій у реальному часі. Використання технології контейнеризації Docker дозволило забезпечити ідентичність середовищ розробки та промислової експлуатації, що є критично важливим для стабільної роботи розподілених IoT-систем.
     На рівні серверної архітектури було підтверджено ефективність обраного стеку NestJS та PostgreSQL. Завдяки впровадженню TypeORM та механізму міграцій вдалося автоматизувати управління схемою бази даних, включаючи специфічне збереження декартових координат зон приміщень. Ключовим досягненням стало налаштування безпечної взаємодії через брокер EMQX, де реалізовано механізм делегованої аутентифікації пристроїв. Це дозволило централізовано керувати правами доступу RFID-зчитувачів через API бекенду, значно підвищуючи рівень безпеки системи без ускладнення конфігурації самого брокера.
     Важливим етапом роботи стала верифікація функцій реального часу за допомогою Socket.io. Впровадження механізму «кімнат» (Rooms) дозволило оптимізувати мережеве навантаження, забезпечуючи передачу сповіщень про переміщення персоналу лише релевантним адміністраторам. На стороні IoT-клієнта було підтверджено надійність алгоритмів обробки даних («Edge Computing»), зокрема фільтрацію байтових потоків з UART-інтерфейсів та захист від дублювання транзакцій. Інтеграція WiFiManager забезпечила гнучкість налаштування пристроїв через веб-портал, дозволяючи змінювати параметри мережі та авторизації без втручання у програмний код.
     У результаті виконання роботи було набуто практичних навичок адміністрування хмарних серверів, налаштування складних IoT-протоколів та забезпечення наскрізної безпеки в системі. Створена документація, що включає опис інфраструктури, конфігурації Docker Compose та алгоритмів роботи клієнтів, повністю відповідає вимогам до розгортання сучасних програмних комплексів. Верифікація функціональності підтвердила готовність системи InZone до експлуатації в умовах, близьких до реальних.
     Посилання на GitHub для backend частини:
       https://github.com/InZoneProject/backend
     Посилання на GitHub для IOT частини:
       https://github.com/InZoneProject/iot-rfid-reader
		 2



